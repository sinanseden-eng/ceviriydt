<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YDT Çeviri Teknikleri & Sonsuz Pratik</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: {
                        primary: { 50: '#eff6ff', 100: '#dbeafe', 500: '#3b82f6', 600: '#2563eb', 700: '#1d4ed8' },
                    }
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; color: #0f172a; }
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(226, 232, 240, 0.8);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
        }
        .strategy-item { transition: all 0.3s ease; }
        .strategy-item:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05); }
        
        .fade-in { animation: fadeIn 0.4s ease-out forwards; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        .loader-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="antialiased min-h-screen flex flex-col">

    <!-- Header -->
    <header class="bg-white border-b border-slate-200 sticky top-0 z-10 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="p-2 bg-primary-100 text-primary-600 rounded-lg">
                    <i data-lucide="graduation-cap" class="w-6 h-6"></i>
                </div>
                <div>
                    <h1 class="text-xl font-bold text-slate-800 tracking-tight">YDT Master</h1>
                    <p class="text-xs text-slate-500 font-medium">Sonsuz Çeviri Soru Bankası</p>
                </div>
            </div>
            <div class="flex items-center gap-4">
                <!-- Stats Counter -->
                <div class="hidden md:flex flex-col items-end">
                    <span class="text-[10px] uppercase tracking-wider text-slate-400 font-bold">Çözülen Soru</span>
                    <span class="text-lg font-bold text-primary-600 leading-none" id="solvedCounter">0</span>
                </div>
                <div class="hidden sm:flex items-center gap-2 text-sm text-slate-500 font-medium bg-slate-100 px-3 py-1.5 rounded-full border border-slate-200">
                    <i data-lucide="infinity" class="w-4 h-4 text-primary-500"></i>
                    5 Şıklı YDT Motoru
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 w-full grid grid-cols-1 lg:grid-cols-12 gap-8">
        
        <!-- Left Column: Strategies -->
        <div class="lg:col-span-5 xl:col-span-4 space-y-6">
            <div class="mb-6">
                <h2 class="text-2xl font-bold text-slate-800 flex items-center gap-2">
                    <i data-lucide="book-open" class="text-primary-500"></i>
                    YDT Çeviri Taktikleri
                </h2>
                <p class="text-slate-600 mt-2 text-sm leading-relaxed">
                    Gerçek YDT çeviri soruları genellikle <strong>20-35 kelimelik yoğun, bol yan cümleli (relative clause) ve kompleks bağlaçlı</strong> yapılardan oluşur. Doğru şıkkı bulmak için yapıyı analiz edin.
                </p>
            </div>

            <div class="grid grid-cols-1 gap-4">
                <!-- Strategy 1 -->
                <div class="glass-card rounded-xl p-5 strategy-item border-l-4 border-l-blue-500">
                    <h3 class="font-semibold text-slate-800 flex items-center gap-2 text-lg">
                        <span class="flex items-center justify-center w-6 h-6 rounded-full bg-blue-100 text-blue-700 text-xs font-bold">1</span>
                        Özne ve Yüklemi Eşle
                    </h3>
                    <p class="text-slate-600 text-sm mt-2 mb-3">
                        YDT'de en büyük çeldirici, yan cümlenin (ör. "who discovered...") yüklemini cümlenin ana yüklemi ("keşfetti.") gibi çevirmektir. Cümlenin en sonundaki asıl yargıyı bulun.
                    </p>
                </div>

                <!-- Strategy 2 -->
                <div class="glass-card rounded-xl p-5 strategy-item border-l-4 border-l-emerald-500">
                    <h3 class="font-semibold text-slate-800 flex items-center gap-2 text-lg">
                        <span class="flex items-center justify-center w-6 h-6 rounded-full bg-emerald-100 text-emerald-700 text-xs font-bold">2</span>
                        Zaman (Tense) Uyumu
                    </h3>
                    <p class="text-slate-600 text-sm mt-2 mb-3">
                        <i>was/were doing</i> (yapıyordu) ile <i>did</i> (yaptı) veya <i>had done</i> (yapmıştı) ayrımları YDT'nin en vazgeçilmez tuzaklarıdır. Zamandan asla taviz vermeyin.
                    </p>
                </div>

                <!-- Strategy 3 -->
                <div class="glass-card rounded-xl p-5 strategy-item border-l-4 border-l-purple-500">
                    <h3 class="font-semibold text-slate-800 flex items-center gap-2 text-lg">
                        <span class="flex items-center justify-center w-6 h-6 rounded-full bg-purple-100 text-purple-700 text-xs font-bold">3</span>
                        Bağlaç ve Miktar Kalıpları
                    </h3>
                    <p class="text-slate-600 text-sm mt-2 mb-3">
                        <i>Although</i> (-e rağmen), <i>because</i> (için/çünkü), <i>only a few</i> (sadece birkaçı), <i>a series of</i> (bir dizi) gibi kelimeleri Türkçe'de eksiksiz arayın.
                    </p>
                </div>
                
                <!-- Strategy 4 -->
                <div class="glass-card rounded-xl p-5 strategy-item border-l-4 border-l-rose-500">
                    <h3 class="font-semibold text-slate-800 flex items-center gap-2 text-lg">
                        <span class="flex items-center justify-center w-6 h-6 rounded-full bg-rose-100 text-rose-700 text-xs font-bold">4</span>
                        Aktif / Pasif Ayrımı
                    </h3>
                    <p class="text-slate-600 text-sm mt-2">
                        <i>is defined</i> (tanımlanır) yapısını "tanımlar" diye çeviren şıkları anında eleyin. Edilgen yapı her zaman "-ılmak, -ilmek" diye edilgen çevrilmelidir.
                    </p>
                </div>
            </div>

            <!-- BONUS BUTTON -->
            <button id="openPatternsBtn" class="w-full mt-2 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white font-semibold py-4 px-6 rounded-2xl transition-all shadow-md hover:shadow-lg flex items-center justify-between group">
                <div class="flex items-center gap-3">
                    <div class="bg-white/20 p-2 rounded-lg">
                        <i data-lucide="book-bookmark" class="w-6 h-6 text-white"></i>
                    </div>
                    <div class="text-left">
                        <span class="block text-lg">50 Kritik Çeviri Kalıbı</span>
                        <span class="block text-indigo-100 text-xs font-normal">Sınavda en çok çıkan yapılar listesi</span>
                    </div>
                </div>
                <i data-lucide="chevron-right" class="w-5 h-5 group-hover:translate-x-1 transition-transform"></i>
            </button>
        </div>

        <!-- Right Column: Interactive Quiz Area -->
        <div class="lg:col-span-7 xl:col-span-8 relative">
            <div class="sticky top-24">
                <div class="glass-card rounded-2xl overflow-hidden shadow-lg border border-slate-200/60 flex flex-col min-h-[550px]">
                    
                    <!-- App Header -->
                    <div class="bg-gradient-to-r from-slate-800 to-slate-900 px-6 py-5 text-white flex justify-between items-center">
                        <div>
                            <h2 class="text-lg font-semibold flex items-center gap-2">
                                <i data-lucide="bot" class="w-5 h-5 text-primary-400"></i>
                                Akıllı YDT Simülatörü
                            </h2>
                            <p class="text-slate-300 text-xs mt-1" id="currentTopicLabel">Hazır mısınız?</p>
                        </div>
                    </div>

                    <!-- App Body -->
                    <div class="p-6 flex-grow flex flex-col">
                        
                        <!-- Initial State / Controls -->
                        <div id="controls-area" class="text-center pb-2 mt-auto mb-auto">
                            <div class="mb-6">
                                <div class="w-16 h-16 bg-primary-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <i data-lucide="target" class="w-8 h-8 text-primary-600"></i>
                                </div>
                                <h3 class="text-xl font-bold text-slate-800 mb-2">Renkli Çözüm Analizi</h3>
                                <p class="text-slate-500 text-sm max-w-sm mx-auto">Yapay zeka her seferinde <strong>gerçek YDT zorluğunda (20-35 kelime)</strong> 5 şıklı özgün bir soru üretir. Çözdükten sonra <strong>Özne, Yüklem, Zaman ve Kalıpların</strong> renklerle nasıl eşleştiğini göreceksiniz.</p>
                            </div>

                            <button id="generateBtn" class="w-full max-w-md mx-auto bg-primary-600 hover:bg-primary-700 text-white font-medium py-3.5 px-4 rounded-xl transition-all shadow-md hover:shadow-lg flex items-center justify-center gap-2 group">
                                <i data-lucide="zap" class="w-5 h-5 group-hover:scale-110 transition-transform"></i>
                                <span id="generateBtnText">İlk Soruyu Üret</span>
                                <div id="btnSpinner" class="loader-spinner hidden ml-2"></div>
                            </button>
                        </div>

                        <!-- Error State -->
                        <div id="error-alert" class="hidden mt-4 bg-rose-50 text-rose-700 p-4 rounded-xl border border-rose-200 text-sm flex items-start gap-3 fade-in">
                            <i data-lucide="alert-triangle" class="w-5 h-5 shrink-0 mt-0.5"></i>
                            <div>
                                <strong class="block font-semibold">Bağlantı Hatası</strong>
                                <span id="error-msg">Soru üretilirken bir sorun oluştu. Lütfen tekrar deneyin.</span>
                            </div>
                        </div>

                        <!-- Quiz Area (Hidden by default) -->
                        <div id="quiz-container" class="hidden fade-in flex-grow flex flex-col">
                            
                            <!-- Question -->
                            <div class="mb-6">
                                <div class="flex items-center gap-2 mb-2">
                                    <span class="bg-slate-100 text-slate-600 text-xs font-bold px-2.5 py-1 rounded-md uppercase tracking-wider border border-slate-200">İngilizce Cümle</span>
                                </div>
                                <p id="q-english" class="text-lg font-medium text-slate-800 leading-relaxed border-l-4 border-primary-400 pl-4 py-1 bg-slate-50/50 rounded-r-lg">
                                    <!-- Sentence goes here -->
                                </p>
                            </div>

                            <!-- Options (A, B, C, D, E) -->
                            <div class="space-y-2 mb-6" id="options-container">
                                <!-- Options injected via JS -->
                            </div>

                            <!-- Feedback Area -->
                            <div id="feedback-area" class="hidden mt-auto space-y-4 fade-in">
                                
                                <!-- Color Legend -->
                                <div class="flex flex-wrap gap-3 p-3 bg-slate-50 border border-slate-200 rounded-lg text-xs font-semibold shadow-inner justify-center">
                                    <span class="flex items-center gap-1.5"><div class="w-3 h-3 rounded-full bg-blue-600"></div>Özne</span>
                                    <span class="flex items-center gap-1.5"><div class="w-3 h-3 rounded-full bg-red-600"></div>Yüklem (Ana Fiil)</span>
                                    <span class="flex items-center gap-1.5"><div class="w-3 h-3 rounded-full bg-emerald-600"></div>Zaman/Tense</span>
                                    <span class="flex items-center gap-1.5"><div class="w-3 h-3 rounded-full bg-purple-600"></div>Kalıp/Bağlaç</span>
                                </div>

                                <div class="p-4 rounded-xl border" id="feedback-box">
                                    <div class="flex items-center gap-2 mb-3">
                                        <i id="feedback-icon" class="w-5 h-5"></i>
                                        <h4 id="feedback-title" class="font-bold text-sm uppercase tracking-wider"></h4>
                                    </div>
                                    <!-- Color Coded Analysis -->
                                    <div id="correct-explanation" class="text-[15px] mt-3 text-slate-700 leading-relaxed bg-white p-4 rounded-lg border border-slate-200 shadow-sm space-y-3">
                                        <!-- HTML Analysis goes here -->
                                    </div>
                                    <!-- Traps Explanation -->
                                    <div id="incorrect-explanation" class="text-sm mt-3 text-slate-700 leading-relaxed bg-white/60 p-4 rounded-lg border border-slate-100/50 shadow-sm">
                                        <!-- Trap analysis goes here -->
                                    </div>
                                </div>
                                
                                <button id="nextBtn" class="w-full bg-slate-800 hover:bg-slate-900 text-white font-medium py-3.5 px-4 rounded-xl transition-colors shadow-md flex items-center justify-center gap-2 mt-4">
                                    <span>Yeni YDT Sorusu Üret</span>
                                    <i data-lucide="shuffle" class="w-4 h-4"></i>
                                </button>
                            </div>

                        </div>

                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- 50 Patterns Modal -->
    <div id="patternsModal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm transition-opacity" id="modalOverlay"></div>
        <div class="absolute inset-x-4 top-10 bottom-10 md:inset-x-auto md:left-1/2 md:-translate-x-1/2 md:w-full md:max-w-4xl bg-white rounded-2xl shadow-2xl flex flex-col overflow-hidden fade-in">
            <!-- Modal Header -->
            <div class="px-6 py-4 border-b border-slate-100 flex items-center justify-between bg-slate-50">
                <div class="flex items-center gap-3">
                    <div class="bg-indigo-100 p-2 rounded-lg">
                        <i data-lucide="library" class="w-6 h-6 text-indigo-600"></i>
                    </div>
                    <div>
                        <h3 class="text-lg font-bold text-slate-800">YDT İçin En Sık Çıkan 50 Çeviri Kalıbı</h3>
                        <p class="text-xs text-slate-500 font-medium">Sınavda karşına çıkma ihtimali çok yüksek yapılar</p>
                    </div>
                </div>
                <button id="closeModalBtn" class="p-2 text-slate-400 hover:text-rose-500 hover:bg-rose-50 rounded-xl transition-colors">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>
            
            <!-- Modal Body (Scrollable) -->
            <div class="flex-grow overflow-y-auto p-4 sm:p-6 bg-slate-50/50">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3" id="patternsList">
                    <!-- Populated via JS -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize Lucide Icons
        lucide.createIcons();

        // Constants & DOM Elements
        const apiKey = ""; // Managed by Canvas environment
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
        
        const btnGenerate = document.getElementById('generateBtn');
        const btnText = document.getElementById('generateBtnText');
        const btnSpinner = document.getElementById('btnSpinner');
        const errorAlert = document.getElementById('error-alert');
        const quizContainer = document.getElementById('quiz-container');
        const optionsContainer = document.getElementById('options-container');
        const englishText = document.getElementById('q-english');
        const feedbackArea = document.getElementById('feedback-area');
        const nextBtn = document.getElementById('nextBtn');
        const controlsArea = document.getElementById('controls-area');
        const solvedCounterEl = document.getElementById('solvedCounter');
        const currentTopicLabel = document.getElementById('currentTopicLabel');
        
        // Modal DOM Elements
        const patternsModal = document.getElementById('patternsModal');
        const openPatternsBtn = document.getElementById('openPatternsBtn');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const modalOverlay = document.getElementById('modalOverlay');
        const patternsList = document.getElementById('patternsList');
        
        let currentQuizData = null;
        let isGenerating = false;
        let solvedCount = 0;

        // --- 50 PATTERNS DATA & LOGIC ---
        const translationPatterns = [
            { en: "Although / Even though / Much as", tr: "-e rağmen, -se de" },
            { en: "In spite of / Despite", tr: "-e rağmen" },
            { en: "Because of / Due to / Owing to", tr: "-den dolayı, yüzünden" },
            { en: "Therefore / Hence / Thus", tr: "bu yüzden, dolayısıyla" },
            { en: "In addition to / Besides", tr: "-e ek olarak, -ın yanı sıra" },
            { en: "Not only... but also...", tr: "sadece... değil, aynı zamanda..." },
            { en: "Both... and...", tr: "hem... hem de..." },
            { en: "Either... or...", tr: "ya... ya da..." },
            { en: "Neither... nor...", tr: "ne... ne de..." },
            { en: "As well as", tr: "-e ek olarak, -ın yanı sıra, hem de" },
            { en: "As a result of / As a consequence of", tr: "-ın sonucu olarak" },
            { en: "In terms of", tr: "-açısından, bakımından" },
            { en: "By means of", tr: "vasıtasıyla, aracılığıyla" },
            { en: "With respect to / Regarding / As regards", tr: "-e gelince, ile ilgili olarak" },
            { en: "In contrast to / Unlike", tr: "-ın aksine" },
            { en: "On the other hand", tr: "öte yandan" },
            { en: "Provided that / On condition that", tr: "şartıyla" },
            { en: "Unless", tr: "-medikçe, -madıkça" },
            { en: "So that / In order that", tr: "-sın diye, amacıyla" },
            { en: "In order to / So as to", tr: "-mek amacıyla" },
            { en: "As long as / So long as", tr: "-dığı sürece" },
            { en: "Even if", tr: "-se bile" },
            { en: "Whereas / While", tr: "-iken, oysa (kıyaslama)" },
            { en: "Instead of / Rather than", tr: "-ın yerine, -den ziyade" },
            { en: "Regardless of / Irrespective of", tr: "-e bakılmaksızın" },
            { en: "Prior to / Before", tr: "-den önce" },
            { en: "Following / After", tr: "-den sonra, -ın ardından" },
            { en: "By the time", tr: "-dığı zamana kadar" },
            { en: "Ever since", tr: "-den beri" },
            { en: "As if / As though", tr: "sanki ...-mış gibi" },
            { en: "No matter (how/what...)", tr: "her ne (kadar/olursa) olsun" },
            { en: "In the face of", tr: "karşısında (zorluk vb.)" },
            { en: "For the sake of", tr: "uğruna, hatırına" },
            { en: "In the light of", tr: "ışığında, göz önüne alındığında" },
            { en: "With the aim of / With a view to", tr: "amacıyla" },
            { en: "Make up / Account for", tr: "oluşturmak, tekabül etmek" },
            { en: "Pave the way for", tr: "zemin hazırlamak, yol açmak" },
            { en: "Play a crucial role in", tr: "hayati bir rol oynamak" },
            { en: "Bring about / Lead to", tr: "sebep olmak, yol açmak" },
            { en: "Give rise to", tr: "ortaya çıkmasına neden olmak" },
            { en: "Stem from / Arise from", tr: "-den kaynaklanmak" },
            { en: "Depend on / Rely on", tr: "bağlı olmak, güvenmek" },
            { en: "Be associated with", tr: "ile ilişkili olmak" },
            { en: "Be exposed to", tr: "maruz kalmak" },
            { en: "Take into consideration / account", tr: "dikkate almak, hesaba katmak" },
            { en: "At the expense of", tr: "pahasına" },
            { en: "Only a few of which", tr: "ki onların sadece birkaçı" },
            { en: "The vast majority of", tr: "büyük çoğunluğu" },
            { en: "Not so much ... as ...", tr: "...-den ziyade ..." },
            { en: "Be supposed to", tr: "-mesi beklenmek, farz edilmek" }
        ];

        // Populate Modal
        translationPatterns.forEach((p, index) => {
            const card = document.createElement('div');
            card.className = "bg-white p-3 rounded-xl border border-slate-200 shadow-sm flex items-start gap-3 hover:border-indigo-300 transition-colors";
            card.innerHTML = `
                <div class="bg-slate-100 text-slate-500 text-xs font-bold w-7 h-7 rounded-lg flex items-center justify-center shrink-0 mt-0.5">${index + 1}</div>
                <div>
                    <div class="font-bold text-slate-800 text-sm mb-0.5">${p.en}</div>
                    <div class="text-indigo-600 font-medium text-[13px]">${p.tr}</div>
                </div>
            `;
            patternsList.appendChild(card);
        });

        // Modal Listeners
        openPatternsBtn.addEventListener('click', () => {
            patternsModal.classList.remove('hidden');
            lucide.createIcons();
        });
        closeModalBtn.addEventListener('click', () => patternsModal.classList.add('hidden'));
        modalOverlay.addEventListener('click', () => patternsModal.classList.add('hidden'));


        // --- INFINITE QUESTION BANK MATRICES (YDT FOCUSED) ---
        const ydtTopics = [
            "Günlük Yaşam ve Kültür (Daily Life & Culture)",
            "Kısa Biyografiler ve Ünlüler (Short Biographies)",
            "Temel Bilim ve Teknoloji (Basic Science & Tech)",
            "Hayvanlar, Doğa ve İklim (Animals & Nature)",
            "Eğitim ve Okul Hayatı (Education & Schooling)",
            "Seyahat, Turizm ve Şehirler (Travel & Cities)",
            "Sağlık, Spor ve Beslenme (Health & Nutrition)",
            "Popüler Psikoloji ve Davranış (Popular Psychology)",
            "Tarihi Olaylar ve Keşifler (Historical Discoveries)",
            "Sanat, Müzik ve Sinema (Art, Music & Cinema)",
            "İnternet ve Sosyal Medya (Internet & Social Media)",
            "Çevre Bilinci ve Geri Dönüşüm (Environmental Awareness)"
        ];

        const grammarFocus = [
            "Multiple Relative Clauses (İç içe geçmiş Sıfat Cümlecikleri)",
            "Noun Clauses with Question Words (Soru kelimesi içeren İsim Cümlecikleri)",
            "Passive Voice within Participles (V3 ve being V3 yapılı edilgenler)",
            "Conditionals and Inversions (Devrik If Cümlecikleri)",
            "Participles / Reduction (Zaman farkı belirten Having V3 vs Ving)",
            "Conjunctions of Contrast (Zıtlık Bağlaçları - Although, Even if, Much as)",
            "Cause/Effect & Time Clauses (Sebep/Sonuç ve Zaman Bağlaçları karışık)",
            "Complex Quantifiers & Modifiers (Almost any, a series of, a great deal of)"
        ];

        // Structured Prompt Setup
        const systemPrompt = `You are an expert YDT (Yabancı Dil Testi - Turkish University Entrance Exam for Languages) English instructor. 
        Your task is to generate a YDT-level English translation question.
        
        CRITICAL LENGTH & COMPLEXITY: 
        The English sentence MUST be between 20 and 35 words long. It MUST be a complex sentence containing at least one main clause and several subordinate clauses (e.g., relative clauses, noun clauses, participial phrases, or compound objects/subjects) to exactly mimic the dense, academic style of actual YDT exams.
        
        You must provide:
        1. The English sentence (20-35 words).
        2. ONE perfectly correct Turkish translation.
        3. FOUR completely incorrect but highly plausible Turkish translations (to make a 5-option A,B,C,D,E multiple choice question). 
        The distractors MUST use authentic YDT-style traps:
        - Trap 1: Making a subordinate clause's verb the main verb of the sentence.
        - Trap 2: Changing the tense of the main verb (e.g., Simple Past to Past Perfect).
        - Trap 3: Swapping Active and Passive voices (e.g., 'is considered' translated as 'düşünür' instead of 'kabul edilir/düşünülür').
        - Trap 4: Mistranslating, adding or omitting conjunctions / quantifiers (e.g., ignoring "almost", translating "because" as "while").
        
        CRITICAL FORMATTING FOR 'color_coded_analysis_tr':
        You MUST explain the sentence structure by color-coding BOTH the English sentence and the correct Turkish translation. 
        You MUST wrap the matching parts using these EXACT HTML span tags:
        - Subject (Özne) -> <span class="text-blue-600 font-bold">...</span>
        - Main Verb (Ana Yüklem) -> <span class="text-red-600 font-bold">...</span>
        - Tense/Time (Zaman Belirteçleri) -> <span class="text-emerald-600 font-bold">...</span>
        - Specific Patterns/Determining Factors (Kalıplar/Bağlaçlar) -> <span class="text-purple-600 font-bold">...</span>
        
        Example format for color_coded_analysis_tr:
        "<div class='mb-2'><strong>İngilizce:</strong> <span class='text-purple-600 font-bold'>Although</span> <span class='text-blue-600 font-bold'>the famous author</span> <span class='text-red-600 font-bold'>wrote</span> many books <span class='text-emerald-600 font-bold'>in the 19th century</span>, he is not known today.</div>
        <div><strong>Türkçe:</strong> <span class='text-blue-600 font-bold'>Ünlü yazar</span> <span class='text-emerald-600 font-bold'>19. yüzyılda</span> birçok kitap <span class='text-red-600 font-bold'>yazmasına</span> <span class='text-purple-600 font-bold'>rağmen</span>, günümüzde tanınmamaktadır.</div>
        <p class='mt-2'>Gördüğünüz gibi <em>Although</em> bağlacı (...-e rağmen) mor renkle, asıl özne maviyle ve geçmiş zaman vurgusu yeşille eşleşmektedir...</p>"
        
        Also provide 'trap_explanation_tr' explaining briefly why the 4 incorrect options are wrong based on the YDT traps mentioned above.`;

        const generationConfig = {
            responseMimeType: "application/json",
            responseSchema: {
                type: "OBJECT",
                properties: {
                    english_sentence: { type: "STRING" },
                    correct_translation: { type: "STRING" },
                    incorrect_translations: { 
                        type: "ARRAY", 
                        items: { type: "STRING" },
                        description: "Exactly 4 incorrect Turkish translations."
                    },
                    color_coded_analysis_tr: { type: "STRING", description: "Color-coded HTML explanation matching English and Turkish parts." },
                    trap_explanation_tr: { type: "STRING", description: "Explanation of the traps in the 4 incorrect options." }
                },
                required: ["english_sentence", "correct_translation", "incorrect_translations", "color_coded_analysis_tr", "trap_explanation_tr"]
            }
        };

        // Utility: Exponential Backoff Fetch
        async function fetchWithBackoff(payload, retries = 5) {
            let delay = 1000;
            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    
                    if (!response.ok) throw new Error(`HTTP error: ${response.status}`);
                    
                    const data = await response.json();
                    if (data.candidates && data.candidates[0].content.parts[0].text) {
                        return JSON.parse(data.candidates[0].content.parts[0].text);
                    } else {
                        throw new Error('Invalid API response structure');
                    }
                } catch (err) {
                    if (i === retries - 1) throw err;
                    await new Promise(res => setTimeout(res, delay));
                    delay *= 2;
                }
            }
        }

        // Main Action: Generate Question
        async function handleGenerate() {
            if (isGenerating) return;
            
            const randomTopic = ydtTopics[Math.floor(Math.random() * ydtTopics.length)];
            const randomGrammar = grammarFocus[Math.floor(Math.random() * grammarFocus.length)];
            
            currentTopicLabel.innerHTML = `YDT Konusu: <strong>${randomTopic.split('(')[0]}</strong>`;

            // UI Loading State
            isGenerating = true;
            btnText.textContent = "YDT Sorusu Üretiliyor...";
            btnSpinner.classList.remove('hidden');
            btnGenerate.classList.add('opacity-80', 'cursor-not-allowed');
            nextBtn.classList.add('opacity-80', 'cursor-wait');
            nextBtn.disabled = true;
            errorAlert.classList.add('hidden');
            
            if (solvedCount === 0) {
                quizContainer.classList.add('hidden');
            } else {
                feedbackArea.classList.add('hidden');
                optionsContainer.innerHTML = '<div class="text-center py-8 text-slate-400"><div class="loader-spinner !border-slate-200 !border-t-primary-500 mx-auto mb-3"></div>Yapay zeka 5 şıklı, zorlu bir YDT sorusu hazırlıyor...</div>';
            }

            const dynamicPrompt = `Create a completely unique YDT translation question (1 correct, 4 incorrect options).
            CONTEXT THEME: ${randomTopic}
            GRAMMATICAL FOCUS: Ensure the English sentence features: ${randomGrammar}
            
            CRITICAL: The sentence MUST be a complex, multi-clause sentence exactly 20 to 35 words long. Ensure the distractors use authentic YDT-style traps (wrong main verb, active/passive shift, clause mismatch). Follow the color-coding instructions strictly for the analysis.`;

            const payload = {
                contents: [{ parts: [{ text: dynamicPrompt }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
                generationConfig: generationConfig
            };

            try {
                const result = await fetchWithBackoff(payload);
                currentQuizData = result;
                renderQuiz(result);
                controlsArea.classList.add('hidden'); 
            } catch (error) {
                console.error("Generation failed:", error);
                errorAlert.classList.remove('hidden');
                optionsContainer.innerHTML = '';
            } finally {
                // UI Reset
                isGenerating = false;
                btnText.textContent = "İlk Soruyu Üret";
                btnSpinner.classList.add('hidden');
                btnGenerate.classList.remove('opacity-80', 'cursor-not-allowed');
                nextBtn.classList.remove('opacity-80', 'cursor-wait');
                nextBtn.disabled = false;
            }
        }

        // Render Quiz to DOM
        function renderQuiz(data) {
            englishText.textContent = data.english_sentence;
            optionsContainer.innerHTML = '';
            
            // Combine and Randomize 5 options
            let options = [
                { text: data.correct_translation, isCorrect: true }
            ];
            
            if (data.incorrect_translations && Array.isArray(data.incorrect_translations)) {
                data.incorrect_translations.forEach(t => {
                    options.push({ text: t, isCorrect: false });
                });
            }
            
            // Ensure we have exactly 5 options if API returns weird amounts, fallback slice/pad
            options = options.slice(0, 5); 
            options.sort(() => Math.random() - 0.5);

            const labels = ['A', 'B', 'C', 'D', 'E'];

            options.forEach((opt, index) => {
                const btn = document.createElement('button');
                btn.className = "w-full text-left p-3.5 rounded-xl border-2 border-slate-200 bg-white hover:border-primary-400 hover:bg-primary-50 transition-all font-medium text-slate-700 flex gap-3 group focus:outline-none text-[15px]";
                
                btn.innerHTML = `
                    <div class="w-7 h-7 shrink-0 rounded-full border-2 border-slate-300 flex items-center justify-center text-xs font-bold text-slate-500 group-hover:border-primary-500 group-hover:text-primary-600 transition-colors option-indicator mt-0.5">
                        ${labels[index]}
                    </div>
                    <span class="leading-relaxed mt-0.5">${opt.text}</span>
                `;
                
                btn.onclick = () => handleAnswer(btn, opt.isCorrect, options);
                optionsContainer.appendChild(btn);
            });

            quizContainer.classList.remove('hidden');
        }

        // Handle User Answer Selection
        function handleAnswer(selectedBtn, isCorrect, allOptionsData) {
            const allButtons = Array.from(optionsContainer.children);
            
            // Disable all buttons
            allButtons.forEach(btn => {
                btn.disabled = true;
                btn.classList.remove('hover:border-primary-400', 'hover:bg-primary-50', 'cursor-pointer');
            });

            // Highlight Correct and Incorrect
            allButtons.forEach((btn, index) => {
                const isThisCorrect = allOptionsData[index].isCorrect;
                const indicator = btn.querySelector('.option-indicator');
                
                if (isThisCorrect) {
                    btn.classList.add('border-emerald-500', 'bg-emerald-50');
                    indicator.classList.add('bg-emerald-500', 'border-emerald-500', 'text-white');
                    indicator.innerHTML = `<i data-lucide="check" class="w-4 h-4"></i>`;
                } else if (btn === selectedBtn && !isCorrect) {
                    // Selected wrong option
                    btn.classList.add('border-rose-400', 'bg-rose-50');
                    indicator.classList.add('bg-rose-500', 'border-rose-500', 'text-white');
                    indicator.innerHTML = `<i data-lucide="x" class="w-4 h-4"></i>`;
                } else {
                    btn.classList.add('opacity-50');
                }
            });

            lucide.createIcons(); // Refresh icons

            // Update Counter
            solvedCount++;
            solvedCounterEl.textContent = solvedCount;
            solvedCounterEl.classList.add('scale-125', 'text-emerald-500');
            setTimeout(() => {
                solvedCounterEl.classList.remove('scale-125', 'text-emerald-500');
            }, 300);

            // Show Feedback
            showFeedback(isCorrect);
        }

        function showFeedback(isCorrect) {
            const fBox = document.getElementById('feedback-box');
            const fIcon = document.getElementById('feedback-icon');
            const fTitle = document.getElementById('feedback-title');
            
            fBox.className = `p-5 rounded-xl border-2 ${isCorrect ? 'bg-emerald-50/40 border-emerald-200' : 'bg-rose-50/40 border-rose-200'}`;
            fIcon.setAttribute('data-lucide', isCorrect ? 'check-circle' : 'x-circle');
            fIcon.className = `w-6 h-6 ${isCorrect ? 'text-emerald-600' : 'text-rose-600'}`;
            fTitle.textContent = isCorrect ? "Tebrikler, Doğru Çeviri!" : "Tuzağa Düştünüz!";
            fTitle.className = `font-bold text-sm uppercase tracking-wider ${isCorrect ? 'text-emerald-700' : 'text-rose-700'}`;

            // Inject the color-coded analysis generated by AI
            document.getElementById('correct-explanation').innerHTML = `
                <div class="border-b border-slate-100 pb-2 mb-2"><strong class="text-slate-800">✓ Yapısal Eşleştirme Analizi</strong></div>
                ${currentQuizData.color_coded_analysis_tr}
            `;
            
            // Inject trap explanation
            document.getElementById('incorrect-explanation').innerHTML = `
                <strong class="text-rose-700 block mb-1">✗ Çeldirici Analizi:</strong> 
                ${currentQuizData.trap_explanation_tr}
            `;

            lucide.createIcons();
            feedbackArea.classList.remove('hidden');
            
            // Scroll to feedback
            setTimeout(() => {
                feedbackArea.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }, 100);
        }

        // Event Listeners
        btnGenerate.addEventListener('click', handleGenerate);
        nextBtn.addEventListener('click', handleGenerate);

    </script>
    
    <!-- Tailwind Safe Classes for dynamic AI HTML injection -->
    <div class="hidden text-blue-600 text-red-600 text-emerald-600 text-purple-600 font-bold"></div>
</body>
</html>
